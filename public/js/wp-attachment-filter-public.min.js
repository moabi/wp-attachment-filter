function showLoadingProgress(){$("body").addClass("loading");$("#loading-bar").addClass("bar animating")}function hideLoadingProgress(){$("body").removeClass("loading");$("#loading-bar").removeClass("bar animating")}var pdfDoc=null,pageNum=1,pageRendering=false,pageNumPending=null,scale=1.2,canvas=document.getElementById("pdf-canvas"),ctx=canvas?canvas.getContext("2d"):"",pdfViewer=$(".pdf-viewer");if(canvas!==null){document.getElementById("next").addEventListener("click",onNextPage);document.getElementById("prev").addEventListener("click",onPrevPage)}function renderPage(num){pageRendering=true;pdfDoc.getPage(num).then(function(page){var viewport=page.getViewport(scale);canvas.height=viewport.height;canvas.width=viewport.width;var renderContext={canvasContext:ctx,viewport:viewport};var renderTask=page.render(renderContext);renderTask.promise.then(function(){pageRendering=false;if(pageNumPending!==null){renderPage(pageNumPending);pageNumPending=null}})});document.getElementById("page_num").textContent=pageNum}function queueRenderPage(num){if(pageRendering){pageNumPending=num}else{renderPage(num)}}function onPrevPage(){if(pageNum<=1){return}pageNum--;queueRenderPage(pageNum)}function onNextPage(){if(pageNum>=pdfDoc.numPages){return}pageNum++;queueRenderPage(pageNum)}function pdfCloseViewer(){pdfViewer.fadeOut()}function wpafReadPdf($id,$ajax_url){showLoadingProgress();var data={action:"get_pdf",pdfID:$id};var jqxhr=$.post($ajax_url,data).done(function(msg){var uris=jQuery.parseJSON(msg);$.when($.getScript(uris[1]+"compability.js"),$.getScript(uris[1]+"pdf.js"),$.getScript(uris[1]+"pdf.worker.js"),$.Deferred(function(deferred){$(deferred.resolve)})).done(function(){console.log(uris[0]);PDFJS.workerSrc=uris[1]+"pdf.worker.js";PDFJS.getDocument(uris[0]).then(function(pdfDoc_){pdfDoc=pdfDoc_;document.getElementById("page_count").textContent=pdfDoc.numPages;hideLoadingProgress();pdfViewer.fadeIn();renderPage(pageNum)})})}).fail(function(jqXHR,textStatus){console.log("Request failed: "+textStatus)})}function mediaFilter(container,values,$ajaxurl,offset){$resultContainer=$("#res-"+container);$resultContainerTax=$("#"+container).attr("data-default-term");offsetCount=offset?offset:0;var jqxhr=$.post($ajaxurl,{action:"filter_eml_media_query",values:values,offset:offsetCount,tax:$resultContainerTax}).done(function(data){$resultContainer.empty().append(data);activefilters='<div class="active-filters">';for(i=0;i<values.length;i++){$valFilter=values[i].value;if($valFilter!==""&&$valFilter!=="0"){activefilters+="<span>"+values[i].value+"</span>"}else if($valFilter==="0"){activefilters+="<span>All</span>"}}activefilters+="</div>";$resultContainer.find(".em-filters-active").empty().append(activefilters);if(initMpf()){initMpf()}}).fail(function(jqXHR,textStatus){$resultContainer.empty().append("Request failed: "+textStatus)}).always(function(){$resultContainer.addClass("active");$('input[name="eml-submit"]').removeClass("processing");hideLoadingProgress()})}function wpafOffsetQuery(offsetPage){target=$('input[name="eml-submit"]');target.attr("data-offset",offsetPage);target.trigger("click")}function resfreshMediaFilter(wrapper,mediaTax,$ajaxurl){container=wrapper.attr("id");$resultContainer=$("#res-"+container);$resultContainerTax=$("#"+container).attr("data-default-term");var jqxhr=$.post($ajaxurl,{action:"refresh_eml_filters",value:mediaTax}).done(function(data){var obj=jQuery.parseJSON(data);$(".eml-mime-type").replaceWith(obj.mime);acfObj=obj.acf;for(i=0;i<acfObj.length;i++){el=acfObj[i];elID=$(el).attr("id");$("#"+elID).replaceWith(el)}}).fail(function(){console.warn("error")}).always(function(){wrapper.find('input[type="submit"]').prop("disabled",false);$(".js-spin-it").fadeOut();hideLoadingProgress()})}function closeSearchResults(target){targetId=$(target).parents(".filtering-results-eml");targetId.removeClass("active").empty().fadeOut().fadeIn()}jQuery(function(){"use strict";var body=$("body"),root=body.data("root").length?body.data("root")+"/":"",base="/"+root,$ajaxurl=base+"wp-admin/admin-ajax.php";$(".js-pdfreader").click(function(e){e.preventDefault();var $id=$(this).attr("data-id");wpafReadPdf($id,$ajaxurl)});$(".js-pdf-close").click(function(e){e.preventDefault();pdfCloseViewer()});$('input[name="eml-submit"]').click(function(e){e.preventDefault();showLoadingProgress();var offset=$(this).attr("data-offset");$(this).addClass("processing");var container=$(this).parents(".eml-filter-block").attr("id"),values=[];$(".eml-js-filter:checked,.cs-link,.eml-js-term").each(function(){var inputName=$(this).attr("name"),inputValue=$(this).val();values.push({value:inputValue,name:inputName})});mediaFilter(container,values,$ajaxurl,offset)});$('select[name="cs-link"]').change(function(){showLoadingProgress();var wrapper=$(this).parents(".eml-filter-block");wrapper.find('input[type="submit"]').prop("disabled",true);var selectedMediaTax=$(this).find(":selected").val();$(".js-spin-it").fadeIn();resfreshMediaFilter(wrapper,selectedMediaTax,$ajaxurl)})});